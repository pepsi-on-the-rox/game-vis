<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Top 5 Most Played Games with Unique Players</title>
  <style>
    body {
      background-color: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    table {
      width: 80%;
      max-width: 800px;
      margin: 0 auto;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #555;
    }
    th {
      background-color: #333;
    }
    td {
      background-color: #444;
    }
  </style>
</head>
<body>
  <h1>Top 5 Most Played Games</h1>
  <div id="result">
    <p>Loading data...</p>
  </div>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    fetch("datasets/fixed-excali8ur-plays-2025-03-23.json")
      .then(response => {
        if (!response.ok) throw new Error("Network error: " + response.statusText);
        return response.json();
      })
      .then(data => {
        let gameCounts = {};
        let gameUniquePlayers = {};
  
        data.forEach(item => {
          let game = item["\"game name\""];
          if (game) {
            game = game.trim();
            gameCounts[game] = (gameCounts[game] || 0) + 1;
  
            if (!gameUniquePlayers[game]) gameUniquePlayers[game] = new Set();
            Object.keys(item).forEach(key => {
              let lowerKey = key.toLowerCase();
              if (lowerKey.includes("player") && lowerKey.includes("name") && !lowerKey.includes("username")) {
                let playerName = item[key].trim();
                if (playerName !== "") {
                  gameUniquePlayers[game].add(playerName);
                }
              }
            });
          }
        });
  
        let gamesArray = [];
        for (let game in gameCounts) {
          gamesArray.push({
            game: game,
            count: gameCounts[game],
            unique: gameUniquePlayers[game].size
          });
        }
  
        gamesArray.sort((a, b) => b.count - a.count);
        let topGames = gamesArray.slice(0, 5);
  
        d3.select("#result").html("");
  
        const width = 1400;
        const height = 500;
        const svg = d3.select("#result")
          .append("svg")
          .attr("width", width)
          .attr("height", height);
  
        const cardWidth = 220;
        const cardHeight = 320;
        const spacing = 240;
        const startX = 40;
        const startY = 80;
  
        const cards = svg.selectAll("g.card")
          .data(topGames)
          .enter()
          .append("g")
          .attr("class", "card")
          .attr("transform", (d, i) => `translate(${startX + i * spacing}, ${startY})`);
  
        // Outer rounded card (red)
        cards.append("rect")
          .attr("width", cardWidth)
          .attr("height", cardHeight)
          .attr("rx", 20)
          .attr("ry", 20)
          .attr("fill", "#cc0000")
          .attr("stroke", "#999")
          .attr("stroke-width", 3);
  
        // Top-left circle (ranking)
        cards.append("circle")
          .attr("cx", 25)
          .attr("cy", 25)
          .attr("r", 25)
          .attr("fill", "#ccc");
  
        cards.append("text")
          .attr("x", 25)
          .attr("y", 30)
          .attr("text-anchor", "middle")
          .attr("fill", "black")
          .style("font-size", "16px")
          .text((d, i) => `#${i + 1}`);
  
        // Large rectangle (image placeholder)
        cards.append("rect")
          .attr("x", 15)
          .attr("y", 60)
          .attr("width", cardWidth - 30)
          .attr("height", 120)
          .attr("fill", "#aaa");
  
        // Game name block
        cards.append("rect")
          .attr("x", 15)
          .attr("y", 190)
          .attr("width", cardWidth - 30)
          .attr("height", 40)
          .attr("rx", 8)
          .attr("ry", 8)
          .attr("fill", "#ddd");
  
        cards.append("text")
          .attr("x", cardWidth / 2)
          .attr("y", 215)
          .attr("text-anchor", "middle")
          .attr("fill", "black")
          .style("font-weight", "bold")
          .style("font-size", "14px")
          .text(d => d.game);
  
        // Curved textbox at bottom
        cards.append("path")
          .attr("d", `M15,240 h${cardWidth - 30} a10,10 0 0 1 10,10 v40 a10,10 0 0 1 -10,10 h-${cardWidth - 30} a10,10 0 0 1 -10,-10 v-40 a10,10 0 0 1 10,-10`)
          .attr("fill", "#bbb");
  
        // Bottom-left circle (number of plays)
        cards.append("circle")
          .attr("cx", 40)
          .attr("cy", cardHeight - 30)
          .attr("r", 25)
          .attr("fill", "#ccc");
  
        cards.append("text")
          .attr("x", 40)
          .attr("y", cardHeight - 25)
          .attr("text-anchor", "middle")
          .attr("fill", "black")
          .style("font-size", "14px")
          .text(d => d.count);
  
        // Bottom-right circle (unique players)
        cards.append("circle")
          .attr("cx", cardWidth - 40)
          .attr("cy", cardHeight - 30)
          .attr("r", 25)
          .attr("fill", "#ccc");
  
        cards.append("text")
          .attr("x", cardWidth - 40)
          .attr("y", cardHeight - 25)
          .attr("text-anchor", "middle")
          .attr("fill", "black")
          .style("font-size", "14px")
          .text(d => d.unique);
      })
      .catch(error => {
        d3.select("#result").html(`<p>Error loading data: ${error.message}</p>`);
      });
  </script>
</body>
</html>
